<!--pages/promotion/index.wxml-->
<view>
  <view class="promotion_box">
    <image class="back_img" src="{{back_img}}" mode="aspectFill"></image>
    <van-button wx:if="{{name!=''}}" catch:click="updateToken" class="clear_btn" color="#37444A" type="primary" size="small">更新数据</van-button>
    <van-button wx:if="{{has_user==1}}" catch:click="changeIdentity" class="change_btn" color="#37444A" type="primary" size="small">切换身份</van-button>
    <view class="person_box">
      <view class="person_info_box">
        <user-btn bind:mylogin="getUserLogin">
          <view class="person_avatar"><image src="{{avatar}}" mode="widthFix"></image></view>
          <view class="person_name">{{id_title}} {{name?name:'点击登录账户'}}</view>
        </user-btn>
        <user-phone bind:myphone="getUserPhone" wx:if="{{phone == null && (identity == 'consumer' || identity == '' || identity == null)}}">
          <van-button wx:if="{{name!=''}}" class="phone_btn" color="#37444A" type="primary" size="small">获取手机号</van-button>
        </user-phone>
        <van-button wx:if="{{identity != 'consumer' && identity != '' && identity != null}}" bind:click="toMyHouse" color="#37444A" class="left_btn" type="primary" size="small">
          {{!is_click?'我的商家':'我的主页'}}
        </van-button>
        <van-button wx:if="{{identity != 'seller'}}" bind:click="scanCode" color="#37444A" icon="scan" class="scanCode" type="primary" size="small">
          扫码播放视频
        </van-button>
        <!-- <button wx:if="{{identity == 'boss' && is_issue == 1}}" type="primary" bindtap="toIssue" class="issue_btn" size="mini">从编辑发行</button> -->
      </view>
      
      <view wx:if="{{is_home}}">
        <promotion-list list="{{promotion_list}}" bind:myevent="getListClick"></promotion-list>
      </view>
      <view wx:else>
        <!-- 促销券编辑 -->
        <block wx:if="{{is_list == 0}}">
          <view class="browse_box">
            <van-button bindtap="selectUserCoupon" color="#37444A" type="primary" size="small" class="customize_add" wx:if="{{identity == 'boss'}}">自定义促销券</van-button>
            <scroll-view bindscrolltolower="getCouponMore" lower-threshold="100" class="scroll_view_H" scroll-x="true">
              <view class="scroll_item" bindtap="selectCoupon" data-index="{{index}}" wx:for="{{coupon_list}}" wx:key="index">
                <view class="txt">{{item.couponName}}</view>
                <image src="{{item.src}}" mode="widthFix"></image>
              </view>
            </scroll-view>
          </view>
        </block>
        <!-- 促销券发行 -->
        <block wx:else>
          <view class="browse_box">
            <scroll-view bindscrolltolower="getIssuedMore" lower-threshold="100" class="scroll_view_H" scroll-x="true">
              <view class="scroll_item" bindlongpress="delCoupon" bindtap="selectCoupon" data-index="{{index}}" wx:for="{{issued_list}}" wx:key="index">
                <view class="txt">{{item.couponName}}</view>
                <image src="{{item.src}}" mode="widthFix"></image>
              </view>
            </scroll-view>
          </view>
        </block>
      </view>
      
      <view class="mine" catchtap="toUser"><image src="../../assets/mine.png" mode="widthFix"></image></view>
    </view>
  </view>
</view>